<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow" style="border-radius:1.5rem;">
                <div class="card-header bg-primary text-white" style="border-radius: 1.5rem 1.5rem 0 0;">
                    <h2 class="mt-2">âž• Add New Recipe</h2>
                </div>
                <div class="card-body">
                    <!-- Display errors if any -->
                    @if (errors.length > 0) {
                    <div class="alert alert-danger">
                        <div>{{error}}</div>
                        <ul class="mb-0">
                            @for (err of errors; track err) {
                            <li>{{ err }}</li>
                            }
                        </ul>
                    </div>
                    }

                    <form class="row g-4" id="recipeForm" (ngSubmit)="onSubmit()" #recipeForm="ngForm">
                        <!-- Basic Information -->
                        <div class="col-12">
                            <label for="title" class="form-label">Recipe Title</label>
                            <input type="text" class="form-control" id="title" name="title" [(ngModel)]="formData.title"
                                #title="ngModel" required minlength="3" maxlength="100"
                                placeholder="e.g., Chocolate Chip Cookies"
                                [class.is-invalid]="title.invalid && title.touched">
                            @if (title.invalid && title.touched) {
                            <div class="invalid-feedback">
                                @if (title.errors?.['required']) {
                                <div>Title is required</div>
                                }
                                @if (title.errors?.['minlength']) {
                                <div>Title must be at least 3 characters</div>
                                }
                                @if (title.errors?.['maxlength']) {
                                <div>Title cannot exceed 100 characters</div>
                                }
                            </div>
                            }
                        </div>

                        <div class="col-md-6">
                            <label for="chef" class="form-label">Chef Name</label>
                            <input type="text" class="form-control" id="chef" name="chef" [(ngModel)]="formData.chef"
                                #chef="ngModel" disabled placeholder="e.g., John Smith">
                        </div>

                        <div class="col-md-6">
                            <label for="prepTime" class="form-label">Preparation Time (minutes)</label>
                            <input type="number" class="form-control" id="prepTime" name="prepTime"
                                [(ngModel)]="formData.prepTime" #prepTime="ngModel" required min="1" max="480"
                                placeholder="e.g., 30" [class.is-invalid]="prepTime.invalid && prepTime.touched">
                            @if (prepTime.invalid && prepTime.touched) {
                            <div class="invalid-feedback">
                                @if (prepTime.errors?.['required']) {
                                <div>Prep time is required</div>
                                }
                                @if (prepTime.errors?.['min']) {
                                <div>Prep time must be at least 1 minute</div>
                                }
                                @if (prepTime.errors?.['max']) {
                                <div>Prep time cannot exceed 480 minutes</div>
                                }
                            </div>
                            }
                        </div>

                        <!-- Recipe Details -->
                        <div class="col-md-6">
                            <label for="mealType" class="form-label">Meal Type</label>
                            <select class="form-select" id="mealType" name="mealType" [(ngModel)]="formData.mealType"
                                #mealType="ngModel" required [class.is-invalid]="mealType.invalid && mealType.touched">
                                <option value="">Choose...</option>
                                @for (type of mealTypes; track type) {
                                <option [value]="type">
                                    {{ type.charAt(0).toUpperCase() + type.slice(1) }}
                                </option>
                                }
                            </select>
                            @if (mealType.invalid && mealType.touched) {
                            <div class="invalid-feedback">
                                @if (mealType.errors?.['required']) {
                                <div>Meal type is required</div>
                                }
                            </div>
                            }
                        </div>

                        <div class="col-md-6">
                            <label for="cuisineType" class="form-label">Cuisine Type</label>
                            <select class="form-select" id="cuisineType" name="cuisineType"
                                [(ngModel)]="formData.cuisineType" #cuisineType="ngModel" required
                                [class.is-invalid]="cuisineType.invalid && cuisineType.touched">
                                <option value="">Choose...</option>
                                @for (type of cuisineTypes; track type) {
                                <option [value]="type">
                                    {{ type.charAt(0).toUpperCase() + type.slice(1) }}
                                </option>
                                }
                            </select>
                            @if (cuisineType.invalid && cuisineType.touched) {
                            <div class="invalid-feedback">
                                @if (cuisineType.errors?.['required']) {
                                <div>Cuisine type is required</div>
                                }
                            </div>
                            }
                        </div>

                        <div class="col-md-6">
                            <label for="difficulty" class="form-label">Difficulty</label>
                            <select class="form-select" id="difficulty" name="difficulty"
                                [(ngModel)]="formData.difficulty" #difficulty="ngModel" required
                                [class.is-invalid]="difficulty.invalid && difficulty.touched">
                                <option value="">Choose...</option>
                                @for (type of difficultyTypes; track type) {
                                <option [value]="type">
                                    {{ type.charAt(0).toUpperCase() + type.slice(1) }}
                                </option>
                                }
                            </select>
                            @if (difficulty.invalid && difficulty.touched) {
                            <div class="invalid-feedback">
                                @if (difficulty.errors?.['required']) {
                                <div>Difficulty is required</div>
                                }
                            </div>
                            }
                        </div>

                        <div class="col-md-6">
                            <label for="servings" class="form-label">Servings</label>
                            <input type="number" class="form-control" id="servings" name="servings"
                                [(ngModel)]="formData.servings" #servings="ngModel" required min="1" max="20"
                                placeholder="e.g., 4" [class.is-invalid]="servings.invalid && servings.touched">
                            @if (servings.invalid && servings.touched) {
                            <div class="invalid-feedback">
                                @if (servings.errors?.['required']) {
                                <div>Servings is required</div>
                                }
                                @if (servings.errors?.['min']) {
                                <div>Servings must be at least 1</div>
                                }
                                @if (servings.errors?.['max']) {
                                <div>Servings cannot exceed 20</div>
                                }
                            </div>
                            }
                        </div>

                        <!-- Ingredients -->
                        <div class="col-12">
                            <label for="ingredients" class="form-label">Ingredients (one per line)</label>
                            <textarea class="form-control" id="ingredients" name="ingredients" rows="5"
                                [(ngModel)]="formData.ingredients" #ingredients="ngModel" required
                                placeholder="Enter each ingredient on a separate line"
                                [class.is-invalid]="ingredients.invalid && ingredients.touched"></textarea>
                            @if (ingredients.invalid && ingredients.touched) {
                            <div class="invalid-feedback">
                                @if (ingredients.errors?.['required']) {
                                <div>Ingredients are required</div>
                                }
                            </div>
                            }
                        </div>

                        <!-- Instructions -->
                        <div class="col-12">
                            <label for="instructions" class="form-label">Instructions (one per line)</label>
                            <textarea class="form-control" id="instructions" name="instructions" rows="5"
                                [(ngModel)]="formData.instructions" #instructions="ngModel" required
                                placeholder="Enter step-by-step instructions separated by new lines"
                                [class.is-invalid]="instructions.invalid && instructions.touched"></textarea>
                            @if (instructions.invalid && instructions.touched) {
                            <div class="invalid-feedback">
                                @if (instructions.errors?.['required']) {
                                <div>Instructions are required</div>
                                }
                            </div>
                            }
                        </div>

                        <!-- Buttons -->
                        <div class="col-12 d-flex justify-content-center mt-4 gap-2">
                            <button type="submit" class="btn btn-primary" [disabled]="loading">
                                @if (loading) {
                                <span class="spinner-border spinner-border-sm me-2" role="status"
                                    aria-hidden="true"></span>
                                }
                                {{ loading ? 'Creating...' : 'Add Recipe' }}
                            </button>
                            <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="loading">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>