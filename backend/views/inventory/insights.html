  <%- include('../partials/header', { title, isLoggedIn, user }) %>
  <div class="container mt-5">
    <h1 class="mb-4">HD Task 4: Inventory Insights & Optimization</h1>
    <a href="/<% if (isLoggedIn) { %>?userId=<%= user.userId %><% } %>" class="btn btn-outline-primary mb-4">Back to Home</a>

    <% if (inventoryInsights) { %>
      <div class="card mb-4">
        <div class="card-header bg-warning text-black">Use Soon (Expiring Items)</div>
        <div class="card-body">
          <% if ((inventoryInsights.expirationWaste || []).length) { %>
            <ul class="list-unstyled">
              <% inventoryInsights.expirationWaste.forEach(it => { %>
                <li><strong><%= it.ingredientName %></strong> - <%= it.quantity %> <%= it.unit %> - value $<%= (it.valueAtRisk||0).toFixed(2) %>
                  <% if (it.recipesUsing && it.recipesUsing.length) { %>
                    <div class="small text-muted">Recipes: <%= it.recipesUsing.map(r=>r.title).join(', ') %></div>
                  <% } %>
                </li>
              <% }) %>
            </ul>
          <% } else { %>
            <p class="text-muted">No items expiring soon.</p>
          <% } %>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header bg-primary text-white">Smart Shopping List (Top Missing Ingredients)</div>
        <div class="card-body">
          <% if ((inventoryInsights.smartShoppingList || []).length) { %>
            <ol>
              <% inventoryInsights.smartShoppingList.forEach(s => { %>
                <li>
                  <div><strong><%= s.ingredient %></strong> - needed by <%= s.recipeCount %> recipes</div>
                  <% if (s.recipes && s.recipes.length) { %>
                    <div class="small mt-1">Recipes: <%= s.recipes.map(r => r.title).join(', ') %></div>
                  <% } %>
                </li>
              <% }) %>
            </ol>
          <% } else { %>
            <p class="text-muted">No missing ingredients detected.</p>
          <% } %>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header bg-black text-white">Monthly Spending by Category (recent)</div>
        <div class="card-body">
          <% if ((inventoryInsights.monthlySpendingByCategory || []).length) { %>
            <table class="table table-sm">
              <thead><tr><th>Year</th><th>Month</th><th>Category</th><th>Total Spent</th></tr></thead>
              <tbody>
                <% inventoryInsights.monthlySpendingByCategory.slice(0,12).forEach(m => { %>
                  <tr><td><%= m.year %></td><td><%= m.month %></td><td><%= m.category %></td><td>$<%= m.totalSpent.toFixed(2) %></td></tr>
                <% }) %>
              </tbody>
            </table>
          <% } else { %>
            <p class="text-muted">No spending data available.</p>
          <% } %>
        </div>
      </div>

    <% } else { %>
      <p class="text-muted">No inventory insights available.</p>
    <% } %>
  </div>
  <%- include('../partials/footer') %>
